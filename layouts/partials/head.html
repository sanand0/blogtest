<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
{{- if hugo.IsProduction | or (eq site.Params.env "production") | and (ne .Params.robotsNoIndex true) }}
<meta name="robots" content="index, follow">
{{- else }}
<meta name="robots" content="noindex, nofollow">
{{- end }}
{{- $base_path := (urls.Parse site.BaseURL).Path | strings.TrimSuffix "/" -}}

{{- /* Title */}}
{{- /* Capitalize title and avoid duplication when title equals site title */}}
<title>{{ if .IsHome }}{{ else }}{{ if .Title }}{{ $pageTitle := .Title | title }}{{ if ne $pageTitle site.Title }}{{ $pageTitle }} | {{ end }}{{ end }}{{ end }}{{ site.Title }}</title>

{{- /* Meta */}}
{{- if .IsHome }}
{{ with site.Params.keywords -}}<meta name="keywords" content="{{- range $i, $e := . }}{{ if $i }}, {{ end }}{{ $e }}{{ end }}">{{ end }}
{{- else }}
<meta name="keywords" content="{{ if .Params.keywords -}}
    {{- range $i, $e := .Params.keywords }}{{ if $i }}, {{ end }}{{ $e }}{{ end }} {{- else }}
    {{- range $i, $e := .Params.tags }}{{ if $i }}, {{ end }}{{ $e }}{{ end }} {{- end -}}">
{{- end }}
{{- $desc := partial "clean_description.html" (dict "page" . "limit" 160) -}}
<meta name="description" content="{{ if $desc }}{{ $desc }}{{ else }}{{ site.Params.description }}{{ end }}">
<meta name="author" content="{{ (partial "author.html" . ) }}">
<link rel="canonical" href="{{ partial "rel_link.html" (dict "from" . "to" .RelPermalink) }}">
{{- if site.Params.analytics.google.SiteVerificationTag }}
<meta name="google-site-verification" content="{{ site.Params.analytics.google.SiteVerificationTag }}">
{{- end }}
{{- if site.Params.analytics.yandex.SiteVerificationTag }}
<meta name="yandex-verification" content="{{ site.Params.analytics.yandex.SiteVerificationTag }}">
{{- end }}
{{- if site.Params.analytics.bing.SiteVerificationTag }}
<meta name="msvalidate.01" content="{{ site.Params.analytics.bing.SiteVerificationTag }}">
{{- end }}
{{- if site.Params.analytics.naver.SiteVerificationTag }}
<meta name="naver-site-verification" content="{{ site.Params.analytics.naver.SiteVerificationTag }}">
{{- end }}

{{- /* Styles */}}

{{- /* includes */}}
{{- $includes := slice }}
{{- $includes = $includes | append (" " | resources.FromString "assets/css/includes-blank.css")}}

{{- if not (eq site.Params.assets.disableScrollBarStyle true) }}
    {{- $ScrollStyle := (resources.Get "css/includes/scroll-bar.css") }}
    {{- $includes = (append $ScrollStyle $includes) }}
{{- end }}

{{- $includes_all := $includes | resources.Concat "assets/css/includes.css" }}

{{- $theme_vars := (resources.Get "css/core/theme-vars.css") }}
{{- $reset := (resources.Get "css/core/reset.css") }}
{{- $media := (resources.Get "css/core/zmedia.css") }}
{{- $license_css := (resources.Get "css/core/license.css") }}
{{- $common := (resources.Match "css/common/*.css") | resources.Concat "assets/css/common.css" }}

{{- /* markup.highlight.noClasses should be set to `false` */}}
{{- $chroma_styles := (resources.Get "css/includes/chroma-styles.css") }}
{{- $chroma_mod := (resources.Get "css/includes/chroma-mod.css") }}

{{- /* order is important */}}
{{- $core := (slice $theme_vars $reset $common $chroma_styles $chroma_mod $includes_all $media) | resources.Concat "assets/css/core.css" | resources.Minify }}
{{- $extended := (resources.Match "css/extended/*.css") | resources.Concat "assets/css/extended.css" | resources.Minify }}

{{- /* bundle all required css */}}
{{- /* Add extended css after theme style */ -}}
{{- $stylesheet := (slice $license_css $core $extended) | resources.Concat "assets/css/stylesheet.css"  }}

{{- if not site.Params.assets.disableFingerprinting }}
{{- $stylesheet := $stylesheet | fingerprint }}
<link crossorigin="anonymous" href="{{ partial "rel_link.html" (dict "from" . "to" $stylesheet.RelPermalink) }}" integrity="{{ $stylesheet.Data.Integrity }}" rel="preload stylesheet" as="style">
{{- else }}
<link crossorigin="anonymous" href="{{ partial "rel_link.html" (dict "from" . "to" $stylesheet.RelPermalink) }}" rel="preload stylesheet" as="style">
{{- end }}

{{- /* Search */}}
{{- if (eq .Layout `search`) -}}
<link crossorigin="anonymous" rel="preload" as="fetch" href="../index.json">
{{- $fastsearch := resources.Get "js/fastsearch.js" | js.Build (dict "params" (dict "fuseOpts" site.Params.fuseOpts)) | resources.Minify }}
{{- $fusejs := resources.Get "js/fuse.basic.min.js" }}
{{- $license_js := resources.Get "js/license.js" }}
{{- if not site.Params.assets.disableFingerprinting }}
{{- $search := (slice $fusejs $license_js $fastsearch ) | resources.Concat "assets/js/search.js" | fingerprint }}
<script defer crossorigin="anonymous" src="{{ partial "rel_link.html" (dict "from" . "to" $search.RelPermalink) }}" integrity="{{ $search.Data.Integrity }}"></script>
{{- else }}
{{- $search := (slice $fusejs $fastsearch ) | resources.Concat "assets/js/search.js" }}
<script defer crossorigin="anonymous" src="{{ partial "rel_link.html" (dict "from" . "to" $search.RelPermalink) }}"></script>
{{- end }}
{{- end -}}

{{- /* Favicons */}}
{{- $favicon := site.Params.assets.favicon | default "favicon.ico" -}}
{{- $favicon16 := site.Params.assets.favicon16x16 | default "favicon-16x16.png" -}}
{{- $favicon32 := site.Params.assets.favicon32x32 | default "favicon-32x32.png" -}}
{{- $apple_touch := site.Params.assets.apple_touch_icon | default "apple-touch-icon.png" -}}
{{- $safari_mask := site.Params.assets.safari_pinned_tab | default "safari-pinned-tab.svg" -}}
{{- $favicon_href := $favicon -}}
{{- $favicon16_href := $favicon16 -}}
{{- $favicon32_href := $favicon32 -}}
{{- $apple_touch_href := $apple_touch -}}
{{- $safari_mask_href := $safari_mask -}}
{{- if and $favicon (not (strings.HasPrefix $favicon "http")) (not (strings.HasPrefix $favicon "/")) -}}
{{- $favicon_href = printf "%s/%s" $base_path $favicon -}}
{{- end }}
{{- if and $favicon16 (not (strings.HasPrefix $favicon16 "http")) (not (strings.HasPrefix $favicon16 "/")) -}}
{{- $favicon16_href = printf "%s/%s" $base_path $favicon16 -}}
{{- end }}
{{- if and $favicon32 (not (strings.HasPrefix $favicon32 "http")) (not (strings.HasPrefix $favicon32 "/")) -}}
{{- $favicon32_href = printf "%s/%s" $base_path $favicon32 -}}
{{- end }}
{{- if and $apple_touch (not (strings.HasPrefix $apple_touch "http")) (not (strings.HasPrefix $apple_touch "/")) -}}
{{- $apple_touch_href = printf "%s/%s" $base_path $apple_touch -}}
{{- end }}
{{- if and $safari_mask (not (strings.HasPrefix $safari_mask "http")) (not (strings.HasPrefix $safari_mask "/")) -}}
{{- $safari_mask_href = printf "%s/%s" $base_path $safari_mask -}}
{{- end }}
<link rel="icon" href="{{ partial "rel_link.html" (dict "from" . "to" $favicon_href) }}">
<link rel="icon" type="image/png" sizes="16x16" href="{{ partial "rel_link.html" (dict "from" . "to" $favicon16_href) }}">
<link rel="icon" type="image/png" sizes="32x32" href="{{ partial "rel_link.html" (dict "from" . "to" $favicon32_href) }}">
<link rel="apple-touch-icon" href="{{ partial "rel_link.html" (dict "from" . "to" $apple_touch_href) }}">
<link rel="mask-icon" href="{{ partial "rel_link.html" (dict "from" . "to" $safari_mask_href) }}">
<meta name="theme-color" content="{{ site.Params.assets.theme_color | default "#2e2e33" }}">
<meta name="msapplication-TileColor" content="{{ site.Params.assets.msapplication_TileColor | default "#2e2e33" }}">

{{- /* RSS */}}
{{ range .AlternativeOutputFormats -}}
<link rel="{{ .Rel }}" type="{{ .MediaType.Type | html }}" href="{{ partial "rel_link.html" (dict "from" $ "to" .RelPermalink) }}" title="{{ .Name }}">
{{ end -}}
{{- range .AllTranslations -}}
<link rel="alternate" hreflang="{{ .Lang }}" href="{{ partial "rel_link.html" (dict "from" $ "to" .RelPermalink) }}">
{{ end -}}

<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    {{- if (and (ne site.Params.defaultTheme "light") (ne site.Params.defaultTheme "dark")) }}
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
    {{- end }}
</noscript>

{{- /* theme-toggle is enabled */}}
{{- if (not site.Params.disableThemeToggle) }}
{{- /* theme is light */}}
{{- if (eq site.Params.defaultTheme "light") }}
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    }

</script>
{{- /* theme is dark */}}
{{- else if (eq site.Params.defaultTheme "dark") }}
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.querySelector("html").dataset.theme = 'light';
    }

</script>
{{- else }}
{{- /* theme is auto */}}
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script>
{{- end }}
{{- /* theme-toggle is disabled and theme is auto */}}
{{- else if (and (ne site.Params.defaultTheme "light") (ne site.Params.defaultTheme "dark"))}}
<script>
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script>
{{- end }}

{{- partial "extend_head.html" . -}}

{{- /* Misc */}}
{{- if hugo.IsProduction | or (eq site.Params.env "production") }}
{{- partial "google_analytics.html" . }}
{{- partial "templates/opengraph.html" . }}
{{- partial "templates/twitter_cards.html" . }}
{{- partial "templates/schema_json.html" . }}
{{- end -}}

{{- /* GoatCounter Analytics: https://sanand0.goatcounter.com/ */ -}}
<script data-goatcounter="https://sanand0.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
